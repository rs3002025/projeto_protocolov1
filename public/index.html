<!DOCTYPE html>
<html lang="pt-BR">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1" />
Â  <title>Sistema de Protocolo</title>
Â  <style>
Â  Â  body {
Â  Â  Â  margin: 0;
Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  background: #f5f5f5;
Â  Â  }
Â  Â  .container {
Â  Â  Â  max-width: 1500px;
Â  Â  Â  margin: 40px auto;
Â  Â  Â  background: #fff;
Â  Â  Â  border-radius: 16px;
Â  Â  Â  box-shadow: 0 0 10px rgba(0,0,0,0.1);
Â  Â  Â  overflow: hidden;
Â  Â  Â  padding-bottom: 30px;
Â  Â  }
.header {
Â  background: #2e7d32;
Â  color: white;
Â  padding: 20px;
Â  text-align: center; /* Centraliza tudo */
}
.content {
Â  display: none;
}

.content.active {
Â  display: block;
}


.logo {
Â  height: 80px; /* Ajuste o tamanho da sua logo aqui */
Â  margin-bottom: 5 px; /* EspaÃ§o entre a logo e os tÃ­tulos */
}

.header h2, .header h3 {
Â  margin: 5px 0; /* EspaÃ§amento entre os tÃ­tulos */
}
.header {
Â  border-radius: 0 0 15px 15px; /* Bordas arredondadas na parte de baixo */
Â  box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Sombra sutil */
}
.header img {
Â  height: 60px; /* Altura fixa para a logo */
Â  width: auto;Â  /* MantÃ©m a proporÃ§Ã£o */
}
Â  Â  .content {
Â  Â  Â  padding: 20px 30px;
Â  Â  }
Â  Â  .menu, .login-screen, .form-screen, .protocolos-screen, .config-screen, .meus-protocolos-screen {
Â  Â  Â  display: none;
Â  Â  }
Â  Â  .active {
Â  Â  Â  display: block;
Â  Â  }
Â  Â  .formulario {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: repeat(12, 1fr);
Â  Â  Â  gap: 15px 20px;
Â  Â  }
Â  Â  .form-group {
Â  Â  Â  display: flex;
Â  Â  Â  flex-direction: column;
Â  Â  }
Â  Â  .full-row { grid-column: span 12; }
Â  Â  .span-6 { grid-column: span 6; }
Â  Â  .span-4 { grid-column: span 4; }
Â  Â  .span-3 { grid-column: span 3; }
Â  Â  .span-2 { grid-column: span 2; }
Â  Â  label { margin-bottom: 5px; font-weight: 600; }
Â  Â  input, select, textarea {
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  padding: 8px;
Â  Â  Â  font-size: 1em;
Â  Â  }
Â  Â  button {
Â  Â  Â  padding: 10px 12px;
Â  Â  Â  border: none;
Â  Â  Â  background: #2e7d32;
Â  Â  Â  color: white;
Â  Â  Â  border-radius: 8px;
Â  Â  Â  cursor: pointer;
Â  Â  Â  margin: 5px 10px 5px 0;
Â  Â  }
Â  Â  .log-area {
Â  Â  Â  margin-top: 20px;
Â  Â  Â  font-size: 0.9em;
Â  Â  Â  background: #eee;
Â  Â  Â  padding: 10px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  min-height: 24px;
Â  Â  }
Â  Â  table {
Â  Â  Â  width: 100%;
Â  Â  Â  border-collapse: collapse;
Â  Â  Â  margin-top: 20px;
Â  Â  }
Â  Â  th, td {
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  padding: 8px;
Â  Â  Â  text-align: left;
Â  Â  Â  vertical-align: top;
Â  Â  }
Â  Â  th {
Â  Â  Â  background-color: #e0e0e0;
Â  Â  }
Â  Â  details {
Â  Â  Â  margin-top: 5px;
Â  Â  Â  font-size: 0.9em;
Â  Â  }
Â  Â  summary {
Â  Â  Â  cursor: pointer;
Â  Â  Â  font-weight: bold;
Â  Â  Â  color: #2e7d32;
Â  Â  }
/* Estilo da tela de relatÃ³rios */
.relatorios-screen {
Â  display: none;
}

.filtros {
Â  display: grid;
Â  grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
Â  gap: 15px;
Â  margin-bottom: 20px;
}

.filtros input, .filtros select {
Â  padding: 8px;
Â  border-radius: 4px;
Â  border: 1px solid #ccc;
}

.relatorios-screen {
Â  display: none;
Â  padding: 20px;
}

.filtros {
Â  display: grid;
Â  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
Â  gap: 15px;
Â  margin-bottom: 20px;
Â  background: #f5f5f5;
Â  padding: 15px;
Â  border-radius: 8px;
}

#resultadosPesquisa {
Â  background: white;
}

.modal-encaminhar-overlay {
Â  position: fixed;
Â  top: 0;
Â  left: 0;
Â  width: 100%;
Â  height: 100%;
Â  background-color: rgba(0, 0, 0, 0.5); /* fundo escuro */
Â  display: flex;
Â  justify-content: center;
Â  align-items: center;
Â  z-index: 1000;
}

.modal-encaminhar-box {
Â  background-color: white;
Â  padding: 20px;
Â  border-radius: 10px;
Â  width: 300px;
Â  max-width: 90%;
Â  box-shadow: 0 0 10px rgba(0,0,0,0.3);
Â  text-align: center;
}

.modal-encaminhar-actions {
Â  margin-top: 15px;
Â  display: flex;
Â  justify-content: space-between;
}

	Â Â 
Â  Â  /* Estilo para o documento PDF / impressÃ£o */
Â  #modeloProtocolo {
Â  Â  width: 100%;
Â  Â  max-width: 700px; /* Largura mÃ¡xima */
Â  Â  margin: 0 auto;
Â  Â  padding: 20px;
Â  Â  font-family: Arial, sans-serif;
Â  Â  font-size: 14px; /* Tamanho fixo para evitar variaÃ§Ãµes */
Â  Â  line-height: 1.5; /* EspaÃ§amento entre linhas */
Â  Â  color: #000;
Â  Â  box-sizing: border-box; /* Garante que padding nÃ£o aumente a largura */
Â  }

Â  #modeloProtocolo h2,Â 
Â  #modeloProtocolo h3 {
Â  Â  text-align: center;
Â  Â  margin: 10px 0;
Â  }

Â  #modeloProtocolo p {
Â  Â  margin: 8px 0;
Â  Â  page-break-inside: avoid; /* Evita que parÃ¡grafos sejam cortados */
Â  }

Â  /* Garante que campos longos (como endereÃ§o) quebrem linhas */
Â  #modeloProtocolo span {
Â  Â  display: inline-block;
Â  Â  max-width: 100%;
Â  Â  word-wrap: break-word;
Â  }
Â  </style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

</head>
<body>
Â  <div class="container">
<div class="header">
Â  <img src="/img/logo.png" alt="Logo" class="logo">
Â  <h2>Prefeitura de Morada Nova</h2>
Â  <h3>Sistema de Protocolo</h3>
</div>

Â  Â  <div id="login" class="login-screen active content">
Â  Â  Â  <label>UsuÃ¡rio</label>
Â  Â  Â  <input type="text" id="usuario" />
Â  Â  Â  <label>Senha</label>
Â  Â  Â  <input type="password" id="senha" />
Â  Â  Â  <button onclick="logar()">Entrar</button>
Â  Â  Â  <p id="loginMsg" style="color:red;"></p>
Â  Â  </div>

Â  Â  <div id="menu" class="menu content">
Â  Â  Â  <button id="btnNovo" onclick="mostrarTela('form')">Novo Protocolo</button>
Â  Â  Â  <button onclick="mostrarTela('protocolos')">Todos os Protocolos</button>
<button onclick="mostrarTela('relatorios')" id="btnRelatorios">RelatÃ³rios</button>
Â  Â  Â  <button onclick="mostrarTela('meusProtocolos')">Meus Protocolos</button>
Â  Â  Â  <button id="btnConfig" onclick="mostrarTela('config')">âš™ï¸ ConfiguraÃ§Ãµes</button>
Â  Â  Â  <button onclick="sair()">Sair</button>
Â  Â  </div>

Â  Â  <div id="form" class="form-screen content">
Â  Â  Â  <form class="formulario" onsubmit="return false;">
Â  Â  Â  Â  <div class="form-group span-3"><label>NÃºmero do Protocolo</label><input type="text" id="numeroProtocolo" readonly></div>
Â  Â  Â  Â  <div class="form-group span-3"><label>MatrÃ­cula</label><input type="text" id="matricula"></div>
Â  Â  Â  Â  <div class="form-group span-6"><label>Nome Completo</label><input type="text" id="nome"></div>
Â  Â  Â  Â  <div class="form-group span-6"><label>EndereÃ§o</label><input type="text" id="endereco"></div>
Â  Â  Â  Â  <div class="form-group span-3"><label>MunicÃ­pio</label><input type="text" id="municipio" value="Morada Nova"></div>
Â  Â  Â  Â <div class="form-group span-3">
Â  <label for="bairro">Bairro</label>
Â  <select id="bairro" name="bairro" class="form-control">
Â  Â  <option value="">Selecione um bairro</option>
Â  Â  <option value="Centro">Centro</option>
Â  Â  <option value="GirilÃ¢ndia">GirilÃ¢ndia</option>
Â  Â  <option value="Padre Assis Monteiro">Padre Assis Monteiro</option>
Â  Â  <option value="HermÃ³genes Henrique GirÃ£o">HermÃ³genes Henrique GirÃ£o</option>
Â  Â  <option value="SÃ£o JosÃ©">SÃ£o JosÃ©</option>
Â  Â  <option value="Nossa Senhora da ConceiÃ§Ã£o">Nossa Senhora da ConceiÃ§Ã£o</option>
Â  Â  <option value="Planalto Aeroporto">Planalto Aeroporto</option>
Â  Â  <option value="JÃºlia Santiago">JÃºlia Santiago</option>
Â  Â  <option value="SÃ£o Francisco">SÃ£o Francisco</option>
Â  Â  <option value="Nova Morada">Nova Morada</option>
Â  Â  <option value="Divino EspÃ­rito Santo">Divino EspÃ­rito Santo</option>
Â  Â  <option value="Alto Tiradentes">Alto Tiradentes</option>
Â  Â  <option value="CapitÃ£o DionÃ­sio Matos de Fontes">CapitÃ£o DionÃ­sio Matos de Fontes</option>
Â  Â  <option value="Irapuan Nobre">Irapuan Nobre</option>
Â  Â  <option value="Dois de Agosto">Dois de Agosto</option>
Â  Â  <option value="Cristo Rei">Cristo Rei</option>
Â  Â  <option value="Sede Rural">Sede Rural</option>
Â  Â  <option value="Outro">Outro</option>
Â  </select>
</div>
Â  Â  Â  Â  <div class="form-group span-3"><label>CEP</label><input type="text" id="cep"></div>
Â  Â  Â  Â  <div class="form-group span-3"><label>Telefone</label><input type="text" id="telefone"></div>
Â  Â  Â  Â  <div class="form-group span-3"><label>CPF</label><input type="text" id="cpf"></div>
Â  Â  Â  Â  <div class="form-group span-3"><label>RG</label><input type="text" id="rg"></div>
Â  Â  Â  Â  <div class="form-group span-3"><label>Data de ExpediÃ§Ã£o</label><input type="date" id="dataExpedicao"></div>
Â  Â  Â  Â  <div class="form-group span-3"><label>Cargo/FunÃ§Ã£o</label><input type="text" id="cargo"></div>
Â  Â  Â  Â  <div class="form-group span-6">
Â  <label>LotaÃ§Ã£o</label>
Â  <select id="lotacao">
Â  Â  <option value="">Selecione...</option>
Â  Â  <option value="AMT">AMT</option>
Â  Â  <option value="IPREMN">IPREMN</option>
Â  Â  <option value="IMAMN">IMAMN</option>
Â  Â  <option value="SAS">SAS</option>
Â  Â  <option value="SEINFRA">SEINFRA</option>
Â  Â  <option value="SESA">SESA</option>
Â  Â  <option value="SEAD">SEAD</option>
Â  Â  <option value="SEAGRI">SEAGRI</option>
Â  Â  <option value="SEAI">SEAI</option>
Â  Â  <option value="SECULT">SECULT</option>
Â  Â  <option value="SEDEM">SEDEM</option>
Â  Â  <option value="SEDUCTEC">SEDUCTEC</option>
Â  Â  <option value="SEFIN">SEFIN</option>
Â  Â  <option value="SSPDC">SSPDC</option>
Â  Â  <option value="SEJUV">SEJUV</option>
Â  Â  <option value="SAAE">SAAE</option>
Â  </select>
</div>

Â  Â  Â  Â  <div class="form-group span-6"><label>Unidade de ExercÃ­cio</label><input type="text" id="unidade"></div>
Â  Â  Â  Â <div class="form-group span-6">
Â  <label>Tipo de Requerimento</label>
Â  <select id="tipo">
Â  Â  <option value="">Selecione...</option>
Â  Â  <option value="Adicional de tempo de serviÃ§os">Adicional de tempo de serviÃ§os</option>
Â  Â  <option value="Adicional de insalubridade">Adicional de insalubridade</option>
Â  Â  <option value="Adicional de periculosidade">Adicional de periculosidade</option>
Â  Â  <option value="Adicional de atividades penosas">Adicional de atividades penosas</option>
Â  Â  <option value="Adicional por serviÃ§os extraordinÃ¡rios">Adicional por serviÃ§os extraordinÃ¡rios</option>
Â  Â  <option value="Adicional noturno">Adicional noturno</option>
Â  Â  <option value="Adicional de fÃ©rias">Adicional de fÃ©rias</option>
Â  Â  <option value="Afastamento p. servir a outro Ã³rgÃ£o ou entidade">Afastamento p. servir a outro Ã³rgÃ£o ou entidade</option>
Â  Â  <option value="Afastamento para exercÃ­cio de mandato eletivo">Afastamento para exercÃ­cio de mandato eletivo</option>
Â  Â  <option value="Afastamento para estudo fora do municÃ­pio">Afastamento para estudo fora do municÃ­pio</option>
Â  Â  <option value="AlteraÃ§Ã£o do cadastro funcional/pessoal">AlteraÃ§Ã£o do cadastro funcional/pessoal</option>
Â  Â  <option value="Aposentadoria">Aposentadoria</option>
Â  Â  <option value="CertidÃ£o por tempo de contribuiÃ§Ã£o">CertidÃ£o por tempo de contribuiÃ§Ã£o</option>
Â  Â  <option value="CÃ³pia de DocumentaÃ§Ã£o">CÃ³pia de DocumentaÃ§Ã£o</option>
Â  Â  <option value="DeclaraÃ§Ã£o">DeclaraÃ§Ã£o</option>
Â  Â  <option value="ExoneraÃ§Ã£o de cargo/funÃ§Ã£o">ExoneraÃ§Ã£o de cargo/funÃ§Ã£o</option>
Â  Â  <option value="FÃ©rias">FÃ©rias</option>
Â  Â  <option value="Ficha financeira">Ficha financeira</option>
Â  Â  <option value="GratificaÃ§Ã£o natalina">GratificaÃ§Ã£o natalina</option>
Â  Â  <option value="GratificaÃ§Ã£o de incentivo profissional">GratificaÃ§Ã£o de incentivo profissional</option>
Â  Â  <option value="GratificaÃ§Ã£o pÃ³s-graduaÃ§Ã£o">GratificaÃ§Ã£o pÃ³s-graduaÃ§Ã£o</option>
Â  Â  <option value="GratificaÃ§Ã£o retribuiÃ§Ã£o pecuniÃ¡ria">GratificaÃ§Ã£o retribuiÃ§Ã£o pecuniÃ¡ria</option>
Â  Â  <option value="GratificaÃ§Ã£o de difÃ­cil acesso">GratificaÃ§Ã£o de difÃ­cil acesso</option>
Â  Â  <option value="LicenÃ§a para atividades polÃ­ticas">LicenÃ§a para atividades polÃ­ticas</option>
Â  Â  <option value="LicenÃ§a para capacitaÃ§Ã£o">LicenÃ§a para capacitaÃ§Ã£o</option>
Â  Â  <option value="LicenÃ§a para desempenho de mandato classista">LicenÃ§a para desempenho de mandato classista</option>
Â  Â  <option value="LicenÃ§a por motivo de doenÃ§a na famÃ­lia">LicenÃ§a por motivo de doenÃ§a na famÃ­lia</option>
Â  Â  <option value="LicenÃ§a por motivo de afastamento do cÃ´njuge">LicenÃ§a por motivo de afastamento do cÃ´njuge</option>
Â  Â  <option value="LicenÃ§a para serviÃ§o militar">LicenÃ§a para serviÃ§o militar</option>
Â  Â  <option value="LicenÃ§a para tratar de interesse particular">LicenÃ§a para tratar de interesse particular</option>
Â  Â  <option value="LicenÃ§a Especial">LicenÃ§a Especial</option>
Â  Â  <option value="ReposiÃ§Ã£o de faltas">ReposiÃ§Ã£o de faltas</option>
Â  Â  <option value="Quebra de vÃ­nculo">Quebra de vÃ­nculo</option>
Â  Â  <option value="CTC">CTC</option>
Â  Â  <option value="SimulaÃ§Ã£o por tempo de serviÃ§o">SimulaÃ§Ã£o por tempo de serviÃ§o</option>
Â  Â  <option value="Acerto de CNIS">Acerto de CNIS</option>
Â  Â  <option value="DeclaraÃ§Ã£o para o Bolsa FamÃ­lia">DeclaraÃ§Ã£o para o Bolsa FamÃ­lia</option>
Â  Â  <option value="DeclaraÃ§Ã£o para seleÃ§Ã£o">DeclaraÃ§Ã£o para seleÃ§Ã£o</option>
Â  Â  <option value="Abono de permanÃªncia">Abono de permanÃªncia</option>
Â  Â  <option value="SalÃ¡rio famÃ­lia">SalÃ¡rio famÃ­lia</option>
Â  Â  <option value="Outros">Outros</option>
Â  </select>
</div>

Â  Â  Â  Â  <div class="form-group span-6">
Â  <label>Requer ao</label>
Â  <select id="requerAo">
Â  Â  <option value="">Selecione...</option>
Â  Â  <option value="SECRETÃRIO">SECRETÃRIO</option>
Â  Â  <option value="COORDENADOR DE RH">COORDENADOR DE RH</option>
Â  Â  <option value="PREFEITA">PREFEITA</option>
Â  </select>
</div>

Â  Â  Â  Â  <div class="form-group span-3"><label>Data SolicitaÃ§Ã£o</label><input type="date" id="dataSolicitacao"></div>
Â  Â  Â  Â <div class="form-group full-row">
Â  <label>InformaÃ§Ãµes Complementares</label>
Â  <textarea id="complemento" rows="8"></textarea>
</div>

Â  Â  Â  </form>
Â  Â  Â  <button onclick="enviarRequerimento()">Enviar Requerimento</button>
Â  Â  Â  <button onclick="window.print()">Imprimir</button>
Â  Â  Â  <button onclick="mostrarTela('menu')">Voltar</button>
Â  Â  Â  <div id="log" class="log-area"></div>
Â  Â  </div>


<div id="modalEncaminhar"Â 
Â  Â  Â style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);Â 
Â  Â  Â  Â  Â  Â  z-index:9999; align-items:center; justify-content:center;">
Â  <div style="background:#fff; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.3); width:300px; max-width:90%;">
Â  Â  <h3>Encaminhar para:</h3>
Â  Â  <select id="selectUsuarioEncaminhar" style="width:100%; margin-bottom:10px;"></select>
Â  Â  <div style="text-align:right;">
Â  Â  Â  <button onclick="confirmarEncaminhamento()" style="margin-right:10px;">Confirmar</button>
Â  Â  Â  <button onclick="fecharModalEncaminhar()">Cancelar</button>
Â  Â  </div>
Â  </div>
</div>




<div id="relatorios" class="relatorios-screen content">
Â  <h3>ğŸ” Pesquisar Protocolos</h3>
Â Â 
Â  Â  <div class="filtros">
Â  Â  <input type="text" id="filtroNumero" placeholder="NÃºmero do Protocolo">
Â  Â  <input type="text" id="filtroNome" placeholder="Nome do Requerente">
Â  Â  <select id="filtroStatus">
Â  Â  Â  <option value="">Todos os status</option>
Â  Â  Â  <option value="Aberto">Aberto</option>
Â  Â  Â  <option value="Em anÃ¡lise">Em anÃ¡lise</option>
Â  Â  Â  <option value="ConcluÃ­do">ConcluÃ­do</option>
Â  Â  </select>
Â  Â  <button onclick="pesquisarProtocolos()">Pesquisar</button>
Â  Â  <button onclick="gerarRelatorio()">ğŸ“Š Gerar RelatÃ³rio</button>
Â  Â  <button onclick="voltarDeRelatorios()">ğŸ”™ Voltar</button>
Â  </div>

Â  Â  <table>
Â  Â  <thead>
Â  Â  Â  <tr>
Â  Â  Â  Â  <th>NÃºmero</th>
Â  Â  Â  Â  <th>Nome</th>
Â  Â  Â  Â  <th>Status</th>
Â  Â  Â  Â  <th>Data SolicitaÃ§Ã£o</th>
Â  Â  Â  Â  <th>Tipo</th>
Â  Â  Â  Â  <th>CPF</th>
Â  Â  Â  </tr>
Â  Â  </thead>
Â  Â  <tbody id="resultadosPesquisa"></tbody>
Â  </table>
</div>




Â  Â  <div id="protocolos" class="protocolos-screen content">
Â  Â  Â  <h3>ğŸ“‹ Lista de Protocolos Enviados</h3>
Â  Â  Â  <table>
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  <tr>
	Â  Â  <th>NÃºmero</th>
Â  Â  Â  Â  Â  Â  <th>MatrÃ­cula</th>
Â  Â  Â  Â  Â  Â  <th>Nome</th>
Â  Â  Â  Â  Â  Â  <th>Tipo</th>
Â  Â  Â  Â  Â  Â  <th>Status</th>
Â  Â  Â  Â  Â  Â  <th>ResponsÃ¡vel</th>
Â  Â  Â  Â  Â  Â  <th>AÃ§Ã£o</th>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody id="tabelaProtocolos"></tbody>
Â  Â  Â  </table>
Â  Â  Â  <button onclick="mostrarTela('menu')">Voltar</button>
Â  Â  </div>
	Â  <div id="paginacaoProtocolos" style="margin-top: 10px;"></div>

    <div id="meusProtocolos" class="meus-protocolos-screen content">
    Â  <h3>ğŸ“‚ Meus Protocolos</h3>
    Â  
      Â  <div class="filtros" style="padding: 10px 0;">
    Â  Â  <input type="text" id="filtroMeusProtocolosNumero" placeholder="Filtrar por NÃºmero">
    Â  Â  <input type="text" id="filtroMeusProtocolosNome" placeholder="Filtrar por Nome">
    Â  Â  <button onclick="listarMeusProtocolos()">Filtrar</button>
    Â  Â  <button onclick="limparFiltrosMeusProtocolos()">Limpar Filtros</button>
    Â  </div>
      Â  <table>
    Â  Â  <thead>
    Â  Â  Â  <tr>
    Â  Â  Â  Â  <th>NÃºmero</th>
    Â  Â  Â  Â  <th>Nome</th>
    Â  Â  Â  Â  <th>Status</th>
    Â  Â  Â  Â  <th>AÃ§Ã£o</th>
    Â  Â  Â  </tr>
    Â  Â  </thead>
    Â  Â  <tbody id="meusProtocolosTabela"></tbody>
    Â  </table>
    Â  <button onclick="voltarDeMeusProtocolos()">Voltar</button>
    </div>
	Â  <div id="paginacaoMeusProtocolos" style="margin-top: 10px;"></div>

Â  Â  <div id="config" class="config-screen content">
Â  Â  Â  <h3>âš™ï¸ ConfiguraÃ§Ãµes</h3>
Â  Â  Â  <div class="form-group full-row">
Â  Â  Â  Â  <label>Email do Sistema:</label>
Â  Â  Â  Â  <input type="email" id="emailSistemaConfig" />
Â  Â  Â  Â  <button onclick="salvarEmailSistema()">Salvar Email</button>
Â  Â  Â  </div>
Â  Â  Â  <div class="form-group full-row">
<label>Adicionar Novo UsuÃ¡rio:</label>

<input type="text" id="nomeCompleto" placeholder="Nome completo" />
<input type="text" id="novoUsuario" placeholder="Nome de usuÃ¡rio" />
<input type="text" id="cpfUsuario" placeholder="CPF (somente nÃºmeros)" />
<input type="password" id="novaSenha" placeholder="Senha" />
<input type="email" id="novoEmail" placeholder="E-mail do usuÃ¡rio" />

<select id="nivelUsuario">
Â  <option value="comum">Comum</option>
Â  <option value="padrao">PadrÃ£o</option>
Â  <option value="admin">Administrador</option>
</select>

<button onclick="cadastrarUsuario()">Cadastrar UsuÃ¡rio</button>

</div>

	<h4>Gerar Backup de Protocolos</h4>
<label>Data InÃ­cio:</label>
<input type="date" id="backupDataInicio" />
<label>Data Fim:</label>
<input type="date" id="backupDataFim" />
<button onclick="gerarBackup()">Gerar Backup</button>

Â  Â  Â  <h4>UsuÃ¡rios Cadastrados:</h4>
Â  Â  Â  <ul id="listaUsuarios"></ul>
Â  Â  Â  <button onclick="mostrarTela('menu')">Voltar</button>
Â  Â  </div>
Â  </div>

Â <div id="modeloProtocolo" style="display: none;">
Â  <style>
Â  Â  /* Estilos do novo layout */
Â  Â  .pdf-body {
Â  Â  Â  font-family: "Segoe UI", "Open Sans", sans-serif;
Â  Â  Â  color: #000;
Â  Â  Â  margin: 0;
Â  Â  Â  padding: 0;
Â  Â  Â  box-sizing: border-box;
Â  Â  }
Â  Â  .doc-container {
Â  Â  Â  background: white;
Â  Â  Â  width: 100%;
Â  Â  Â  max-width: 800px;
Â  Â  Â  margin: 20px auto;
Â  Â  Â  padding: 40px 50px;
Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  box-shadow: 0 0 10px rgba(0,0,0,0.1);
Â  Â  }
Â  Â  .logo-pdf {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 2px;
Â  Â  }
Â  Â  .logo-pdf img {
Â  Â  Â  height: 80px;
Â  Â  }
Â  Â  .titulo-principal-pdf {
Â  Â  Â  text-align: center;
Â  Â  Â  margin: 2px 0;
Â  Â  Â  font-size: 22px;
Â  Â  }
Â  Â  .titulo-central-pdf {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-bottom: 20px;
Â  Â  }
Â  Â  .titulo-central-pdf span {
Â  Â  Â  background: #2e7d32;
Â  Â  Â  color: white;
Â  Â  Â  font-size: 16px;
Â  Â  Â  padding: 8px 20px;
Â  Â  Â  border-radius: 4px;
Â  Â  Â  display: inline-block;
Â  Â  Â  font-weight: bold;
Â  Â  }
Â  Â  .info-pdf {
Â  Â  Â  margin-bottom: 20px;
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  gap: 20px;
Â  Â  }
Â  Â  .campo-destaque-pdf {
Â  Â  Â  font-weight: bold;
Â  Â  Â  /* Alterado de 16px para 14px */
Â  Â  Â  font-size: 14px;Â 
Â  Â  Â  background-color: #2e7d32;
Â  Â  Â  color: white;
Â  Â  Â  padding: 8px 12px;
Â  Â  Â  border-radius: 5px;
Â  Â  Â  margin: 4px 0;
Â  Â  Â  flex: 1;
Â  Â  Â  text-align: center;
Â  Â  }
Â  Â  .section-title-pdf {
Â  Â  Â  background: #f0f0f0;
Â  Â  Â  font-weight: bold;
Â  Â  Â  padding: 6px 10px;
Â  Â  Â  border-left: 4px solid #4caf50;
Â  Â  Â  margin-top: 20px;
Â  Â  }
Â  Â  .grid-pdf {
Â  Â  Â  display: grid;
Â  Â  Â  grid-template-columns: 1fr 1fr;
Â  Â  Â  gap: 8px 30px;
Â  Â  Â  margin-top: 10px;
Â  Â  }
Â  Â  .grid-pdf div {
Â  Â  Â  font-size: 14px;
Â  Â  }
Â  Â  .box-pdf {
Â  Â  Â  border: 1px solid #ddd;
Â  Â  Â  padding: 10px;
Â  Â  Â  border-radius: 6px;
Â  Â  Â  background: #fafafa;
Â  Â  Â  margin-top: 10px;
Â  Â  Â  font-style: italic;
Â  Â  }
Â  Â  .assinaturas-pdf {
Â  Â  Â  display: flex;
Â  Â  Â  justify-content: space-between;
Â  Â  Â  margin-top: 100px;
Â  Â  }
Â  Â  .assinatura-pdf {
Â  Â  Â  text-align: center;
Â  Â  Â  width: 45%;
Â  Â  }
Â  Â  .linha-pdf {
Â  Â  Â  border-top: 1px solid #000;
Â  Â  Â  margin-top: 40px;
Â  Â  }
Â  Â  .rodape-pdf {
Â  Â  Â  text-align: center;
Â  Â  Â  margin-top: 40px;
Â  Â  }
Â  Â  .rodape-pdf img {
Â  Â  Â  max-width: 100%;
Â  Â  Â  height: auto;
Â  Â  }
Â  </style>

Â  <div class="pdf-body doc-container">
Â  Â  <div class="logo-pdf">
Â  Â  Â  <img src="/img/logo.png" alt="Logo Prefeitura" />
Â  Â  </div>

Â  Â  <h1 class="titulo-principal-pdf">Secretaria da AdministraÃ§Ã£o</h1>

Â  Â  <div class="titulo-central-pdf">
Â  Â  Â  <span>PROTOCOLO DE REQUERIMENTO</span>
Â  Â  </div>

Â  Â  <div class="info-pdf">
Â  Â  Â  <p class="campo-destaque-pdf"><strong>NÃºmero do Protocolo:</strong> <span id="doc_numero"></span></p>
Â  Â  Â  <p class="campo-destaque-pdf"><strong>Data da SolicitaÃ§Ã£o:</strong> <span id="doc_dataSolicitacao"></span></p>
Â  Â  </div>

Â  Â  <div class="section-title-pdf">DADOS DO REQUERENTE</div>
Â  Â  <div class="grid-pdf">
Â  Â  Â  <div><strong>Nome:</strong> <span id="doc_nome"></span></div>
Â  Â  Â  <div><strong>Bairro:</strong> <span id="doc_bairro"></span></div>
Â  Â  Â  <div><strong>MatrÃ­cula:</strong> <span id="doc_matricula"></span></div>
Â  Â  Â  <div><strong>MunicÃ­pio:</strong> <span id="doc_municipio"></span></div>
Â  Â  Â  <div><strong>CPF:</strong> <span id="doc_cpf"></span></div>
Â  Â  Â  <div><strong>CEP:</strong> <span id="doc_cep"></span></div>
Â  Â  Â  <div><strong>RG:</strong> <span id="doc_rg"></span></div>
Â  Â  Â  <div><strong>LotaÃ§Ã£o:</strong> <span id="doc_lotacao"></span></div>
Â  Â  Â  <div><strong>EndereÃ§o:</strong> <span id="doc_endereco"></span></div>
Â  Â  Â  <div><strong>Unidade de ExercÃ­cio:</strong> <span id="doc_unidade"></span></div>
Â  Â  Â  <div><strong>Telefone:</strong> <span id="doc_telefone"></span></div>
Â  Â  Â  <div><strong>Cargo/FunÃ§Ã£o:</strong> <span id="doc_cargo"></span></div>
Â  Â  </div>

Â  Â  <div class="section-title-pdf">DADOS DO REQUERIMENTO</div>
Â  Â  <div style="margin-top: 10px;">
Â  Â  Â  <div style="margin-bottom: 6px;"><strong>Tipo de Requerimento:</strong> <span id="doc_tipo"></span></div>
Â  Â  Â  <div style="margin-bottom: 10px;"><strong>Requer ao:</strong> <span id="doc_requerAo"></span></div>
Â  Â  </div>

Â  Â  <div class="box-pdf" id="doc_complemento"></div>

Â  Â  <div class="assinaturas-pdf">
Â  Â  Â  <div class="assinatura-pdf">
Â  Â  Â  Â  <div class="linha-pdf"></div>
Â  Â  Â  Â  Assinatura do Requerente
Â  Â  Â  </div>
Â  Â  Â  <div class="assinatura-pdf">
Â  Â  Â  Â  <div class="linha-pdf"></div>
Â  Â  Â  Â  ResponsÃ¡vel pelo Protocolo
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="rodape-pdf">
Â  Â  Â  <img src="/img/rodape.jpg" alt="RodapÃ©" />
Â  Â  </div>
Â  </div>
</div>
<div id="pdfModal" style="display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6);">
Â  <div style="background-color: #fefefe; margin: 20px auto; padding: 0; border: 1px solid #888; width: 95%; max-width: 800px; box-shadow: 0 4px 8px 0 rgba(0,0,0,0.2), 0 6px 20px 0 rgba(0,0,0,0.19);">
Â  Â  <div style="text-align: right; background: #2e7d32; padding: 5px 15px;">
Â  Â  Â  <span style="color: white; font-size: 28px; font-weight: bold; cursor: pointer;" onclick="fecharModal()">&times;</span>
Â  Â  </div>
Â  Â  <div id="pdfContent" style="padding: 20px;">
Â  Â  Â  </div>
Â  Â  <div style="text-align: center; padding: 10px; border-top: 1px solid #ddd;">
Â  Â  Â  <button onclick="gerarPDF()">Gerar e Salvar PDF</button>
Â  Â  </div>
Â  </div>
</div>



<script defer>
	const itensPorPagina = 10;
	let paginaAtualTodos = 1;
	let paginaAtualMeus = 1;

Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  window.usuarioLogado = localStorage.getItem('usuarioLogado') || "";
Â  Â  window.nivelUsuario = localStorage.getItem('nivelUsuario') || "";

Â  Â  console.log("Verificando sessÃ£o:", window.usuarioLogado, window.nivelUsuario);

Â  Â  if (window.usuarioLogado) {
Â  Â  Â  document.getElementById('btnConfig').style.display = window.nivelUsuario === "admin" ? "inline-block" : "none";
Â  Â  Â  document.getElementById('btnNovo').style.display = (window.nivelUsuario === "admin" || window.nivelUsuario === "padrao") ? "inline-block" : "none";
Â  Â  Â  document.getElementById('btnRelatorios').style.display = (window.nivelUsuario === "admin" || window.nivelUsuario === "padrao") ? "inline-block" : "none";

Â  Â  Â  if (window.nivelUsuario === "comum") {
Â  Â  Â  Â  mostrarTela('meusProtocolos');
Â  Â  Â  } else {
Â  Â  Â  Â  mostrarTela('menu');
Â  Â  Â  }
Â  Â  } else {
Â  Â  Â  mostrarTela('login');
Â  Â  }
Â  });

Â  window.logar = function() {
Â  Â  const user = document.getElementById('usuario').value;
Â  Â  const senha = document.getElementById('senha').value;
Â  Â  const msg = document.getElementById('loginMsg');

Â  Â  fetch('/login', {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  body: JSON.stringify({ login: user, senha: senha })
Â  Â  })
Â  Â  .then(res => res.json())
Â  Â  .then(data => {
Â  Â  Â  if (data.sucesso && data.usuario) {
Â  localStorage.setItem('usuarioLogado', data.usuario.nome);Â  // nome completo
Â  localStorage.setItem('usuarioLogin', data.usuario.login);Â  // login simples
Â  localStorage.setItem('nivelUsuario', data.usuario.tipo);

Â  window.usuarioLogado = data.usuario.nome;
Â  window.usuarioLogin = data.usuario.login;
Â  window.nivelUsuario = data.usuario.tipo;


Â  Â  Â  Â  document.getElementById('btnConfig').style.display = window.nivelUsuario === "admin" ? "inline-block" : "none";
Â  Â  Â  Â  document.getElementById('btnNovo').style.display = (window.nivelUsuario === "admin" || window.nivelUsuario === "padrao") ? "inline-block" : "none";
Â  Â  Â  Â  document.getElementById('btnRelatorios').style.display = (window.nivelUsuario === "admin" || window.nivelUsuario === "padrao") ? "inline-block" : "none";

Â  Â  Â  Â  if (window.nivelUsuario === "comum") {
Â  Â  Â  Â  Â  mostrarTela('meusProtocolos');
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  mostrarTela('menu');
Â  Â  Â  Â  }

Â  Â  Â  Â  msg.textContent = "";
Â  Â  Â  } else {
Â  Â  Â  Â  msg.textContent = "UsuÃ¡rio ou senha incorretos.";
Â  Â  Â  }
Â  Â  })
Â  Â  .catch(err => {
Â  Â  Â  console.error("Erro no login:", err);
Â  Â  Â  msg.textContent = "Erro ao conectar ao servidor.";
Â  Â  });
Â  };

window.addEventListener('load', () => {
Â  Â  const modal = document.getElementById('modalEncaminhar');
Â  Â  modal.style.display = 'none';
Â  });

Â  function mostrarTela(tela) {
Â  ['login','menu','form','config','protocolos','meusProtocolos','relatorios'].forEach(id => {
Â  Â  document.getElementById(id).classList.remove('active');
Â  });

Â  if (tela === 'relatorios' && nivelUsuario === 'comum') {
Â  Â  alert('Acesso restrito!');
Â  Â  return;
Â  }

Â  document.getElementById(tela).classList.add('active');

Â  // Executa as aÃ§Ãµes especÃ­ficas de cada tela
Â  if (tela === 'protocolos') listarProtocolos();
Â  if (tela === 'meusProtocolos') listarMeusProtocolos();
Â  if (tela === 'form') gerarNumeroProtocolo();
Â  if (tela === 'config') atualizarListaUsuarios();
Â  if (tela === 'relatorios') pesquisarProtocolos();
}


function sair() {
Â  // Limpa tudo
Â  localStorage.removeItem('usuarioLogado');
Â  localStorage.removeItem('nivelUsuario');
  localStorage.removeItem('usuarioLogin');
Â  usuarioLogado = "";
Â  nivelUsuario = "";
Â Â 
Â  // Reseta a interface
Â  document.getElementById('usuario').value = "";
Â  document.getElementById('senha').value = "";
Â Â 
Â  // Esconde todos os botÃµes restritos
Â  document.getElementById('btnConfig').style.display = 'none';
Â  document.getElementById('btnNovo').style.display = 'none';
Â  document.getElementById('btnRelatorios').style.display = 'none';
Â Â 
Â  // ForÃ§a mostrar a tela de login
Â  mostrarTela('login');
Â Â 
Â  // Adicione este redirecionamento para garantir
Â  window.location.href = window.location.href.split('?')[0];
}

Â async function gerarNumeroProtocolo() {
Â  const anoAtual = new Date().getFullYear();

Â  try {
Â  Â  const res = await fetch(`/protocolos/ultimoNumero/${anoAtual}`);
Â  Â  const data = await res.json();
Â  Â  const ultimo = data.ultimo || 0;

Â  Â  const novoNumero = `${String(ultimo + 1).padStart(4, '0')}/${anoAtual}`;
Â  Â  document.getElementById('numeroProtocolo').value = novoNumero;
Â  Â  document.getElementById('log').innerText = 'ğŸ“„ NÃºmero gerado: ' + novoNumero;
Â  } catch (error) {
Â  Â  console.error("Erro ao gerar nÃºmero:", error);
Â  Â  const fallbackNumero = `0001/${anoAtual}`;
Â  Â  document.getElementById('numeroProtocolo').value = fallbackNumero;
Â  Â  document.getElementById('log').innerText = 'âš ï¸ NÃºmero gerado localmente: ' + fallbackNumero;
Â  }
}


function paginarProtocolos(lista, pagina, porPagina) {
Â  const inicio = (pagina - 1) * porPagina;
Â  const fim = inicio + porPagina;
Â  return lista.slice(inicio, fim);
}




Â  Â function enviarRequerimento() {
Â  const numeroProtocolo = document.getElementById('numeroProtocolo').value;
Â  if (!numeroProtocolo) {
Â  Â  alert("â—NÃºmero de protocolo nÃ£o gerado.");
Â  Â  return;
Â  }

Â  const dataAgora = new Date().toLocaleString();
Â  const protocolo = {
Â  Â  numero: numeroProtocolo,
Â  Â  matricula: document.getElementById('matricula').value,
Â  Â  nome: document.getElementById('nome').value,
Â  Â  endereco: document.getElementById('endereco').value,
Â  Â  municipio: document.getElementById('municipio').value,
Â  Â  bairro: document.getElementById('bairro').value,
Â  Â  cep: document.getElementById('cep').value,
Â  Â  telefone: document.getElementById('telefone').value,
Â  Â  cpf: document.getElementById('cpf').value,
Â  Â  rg: document.getElementById('rg').value,
Â  Â  dataExpedicao: document.getElementById('dataExpedicao').value,
Â  Â  cargo: document.getElementById('cargo').value,
Â  Â  lotacao: document.getElementById('lotacao').value,
Â  Â  unidade: document.getElementById('unidade').value,
Â  Â  tipo: document.getElementById('tipo').value,
Â  Â  requerAo: document.getElementById('requerAo').value,
Â  Â  dataSolicitacao: document.getElementById('dataSolicitacao').value,
Â  Â  complemento: document.getElementById('complemento').value,
Â  Â  dataEnvio: dataAgora,
Â  Â  status: "Enviado",
Â  Â  responsavel: usuarioLogado,
Â  Â  movimentacoes: [
Â  Â  Â  { data: dataAgora, acao: "Criado e enviado", autor: usuarioLogado }
Â  Â  ]
Â  };

Â  fetch('/protocolos', {
Â  Â  method: 'POST',
Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  body: JSON.stringify(protocolo)
Â  })
Â  .then(res => res.json())
Â  .then(data => {
Â  Â  if (data.sucesso) {
Â  Â  Â  alert('âœ… Protocolo enviado e salvo no banco com sucesso!');
Â  Â  Â  document.querySelector('.formulario').reset();
Â  Â  Â  gerarNumeroProtocolo(); // Gera o prÃ³ximo nÃºmero para novo envio
Â  Â  } else {
Â  Â  Â  alert('âŒ Erro ao enviar protocolo: ' + (data.mensagem || 'Erro desconhecido'));
Â  Â  }
Â  })
Â  .catch(err => {
Â  Â  alert('âŒ Erro na conexÃ£o: ' + err.message);
Â  });
}


Â Â 

async function listarProtocolos(pagina = 1) {
Â  const tbody = document.getElementById('tabelaProtocolos');
Â  tbody.innerHTML = "";
Â  paginaAtualTodos = pagina;

Â  try {
Â  Â  const res = await fetch('/protocolos');
Â  Â  const data = await res.json();

Â  Â  const inicio = (pagina - 1) * itensPorPagina;
Â  Â  const fim = inicio + itensPorPagina;
Â  Â  const paginaDados = data.protocolos.slice(inicio, fim);

Â  Â  paginaDados.forEach(p => {
Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  <td style="width: 80px; text-align: center;">${p.numero}</td>
Â  Â  Â  Â  <td>${p.matricula}</td>
Â  Â  Â  Â  <td>${p.nome}</td>
Â  Â  Â  Â  <td>${p.tipo_requerimento}</td>
Â  Â  Â  Â  <td>${p.status}</td>
Â  Â  Â  Â  <td>${p.responsavel}</td>
Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  <button onclick="abrirAtualizar(${p.id})">Atualizar</button>
Â  Â  Â  Â  Â  <button onclick="abrirModalEncaminhar(${p.id}, event)">Encaminhar</button>
Â  Â  Â  Â  Â  <button onclick="verDetalhes(${p.id})">Ver Detalhes</button>
Â  Â  Â  Â  <button onclick="previsualizarPDF(${p.id})">ğŸ“„ Documento</button>
Â  Â  Â  Â  Â  <details id="hist_${p.id}">
Â  Â  Â  Â  Â  Â  <summary>HistÃ³rico</summary>
Â  Â  Â  Â  Â  </details>
Â  Â  Â  Â  </td>`;
Â  Â  Â  tbody.appendChild(tr);
Â  Â  Â  setTimeout(() => carregarHistorico(p.id), 100);
Â  Â  });

Â  Â  renderizarPaginacao(data.protocolos.length, pagina, 'paginacaoProtocolos', listarProtocolos);

Â  } catch (error) {
Â  Â  console.error("Erro ao listar protocolos:", error);
Â  Â  alert("Erro ao buscar protocolos do banco.");
Â  }
}


async function listarMeusProtocolos(pagina = 1) {
Â  const tbody = document.getElementById('meusProtocolosTabela');
Â  tbody.innerHTML = "";
Â  paginaAtualMeus = pagina;

  // --- InÃ­cio da LÃ³gica de Filtro ---
Â  const filtroNumero = document.getElementById('filtroMeusProtocolosNumero').value.trim().toLowerCase();
Â  const filtroNome = document.getElementById('filtroMeusProtocolosNome').value.trim().toLowerCase();
  // --- Fim da LÃ³gica de Filtro ---

Â  try {
Â  Â  const res = await fetch('/protocolos');
Â  Â  const data = await res.json();

    const usuarioLogin = localStorage.getItem('usuarioLogin'); // Usando o login salvo
Â  Â  if (!usuarioLogin) {
Â  Â  Â  console.error("Login de usuÃ¡rio nÃ£o encontrado no localStorage.");
Â  Â  Â  return;
Â  Â  }

Â  Â  const protocolosFiltrados = data.protocolos.filter(p => {
      // CondiÃ§Ã£o 1: Pertence ao usuÃ¡rio logado
      const responsavelMatch = (p.responsavel || "").trim().toLowerCase() === usuarioLogin.trim().toLowerCase();
      if (!responsavelMatch) return false;

      // CondiÃ§Ã£o 2: Filtro por nÃºmero do protocolo (se preenchido)
      const numeroMatch = !filtroNumero || (p.numero || "").toLowerCase().includes(filtroNumero);

      // CondiÃ§Ã£o 3: Filtro por nome do requerente (se preenchido)
      const nomeMatch = !filtroNome || (p.nome || "").toLowerCase().includes(filtroNome);

      return numeroMatch && nomeMatch;
    });

Â  Â  const inicio = (pagina - 1) * itensPorPagina;
Â  Â  const fim = inicio + itensPorPagina;
Â  Â  const paginaDados = protocolosFiltrados.slice(inicio, fim);

Â  Â  paginaDados.forEach(p => {
Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  <td>${p.numero}</td>
Â  Â  Â  Â  <td>${p.nome}</td>
Â  Â  Â  Â  <td>${p.status}</td>
Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  <button onclick="abrirAtualizar(${p.id})">Atualizar</button>
Â  Â  Â  Â  Â  <button onclick="abrirModalEncaminhar(${p.id}, event)">Encaminhar</button>
Â  Â  Â  Â  Â  <button onclick="verDetalhes(${p.id})">Ver Detalhes</button>
Â  Â  Â  Â  Â  <button onclick="previsualizarPDF(${p.id})">ğŸ“„ Documento</button>
Â  Â  Â  Â  Â  <details id="hist_${p.id}">
Â  Â  Â  Â  Â  Â  <summary>HistÃ³rico</summary>
Â  Â  Â  Â  Â  </details>
Â  Â  Â  Â  </td>`;
Â  Â  Â  tbody.appendChild(tr);
Â  Â  Â  setTimeout(() => carregarHistorico(p.id), 100);
Â  Â  });

Â  Â  renderizarPaginacao(protocolosFiltrados.length, pagina, 'paginacaoMeusProtocolos', listarMeusProtocolos);

Â  } catch (error) {
Â  Â  console.error("Erro ao listar meus protocolos:", error);
Â  Â  alert("Erro ao buscar dados.");
Â  }
}

function limparFiltrosMeusProtocolos() {
  document.getElementById('filtroMeusProtocolosNumero').value = '';
  document.getElementById('filtroMeusProtocolosNome').value = '';
  listarMeusProtocolos(); // Chama a funÃ§Ã£o novamente para exibir a lista completa
}


Â  async function abrirEncaminhar(id) {
Â  const novoResp = prompt("Para qual usuÃ¡rio deseja encaminhar?");
Â  if (novoResp) {
Â  Â  try {
Â  Â  Â  const response = await fetch(`/protocolos/atualizar`, {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  protocoloId: id,
Â  Â  Â  Â  Â  novoStatus: "Encaminhado",
Â  Â  Â  Â  Â  novoResponsavel: novoResp,
Â  Â  Â  Â  Â  observacao: `Encaminhado por ${usuarioLogado} para ${novoResp}`, // ğŸ‘ˆ Mostra QUEM encaminhou
Â  Â  Â  Â  Â  usuarioLogado: usuarioLogado // ğŸ‘ˆ Envia quem estÃ¡ fazendo a aÃ§Ã£o
Â  Â  Â  Â  })
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  const data = await response.json();
Â  Â  Â Â 
Â  Â  Â  if (data.sucesso) {
Â  Â  Â  Â  alert("âœ… Protocolo encaminhado com sucesso!");
Â  Â  Â  Â  await carregarHistorico(id);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Atualiza as listas se estiverem visÃ­veis
Â  Â  Â  Â  if (document.getElementById('protocolos').classList.contains('active')) {
Â  Â  Â  Â  Â  await listarProtocolos();
Â  Â  Â  Â  }
Â  Â  Â  Â  if (document.getElementById('meusProtocolos').classList.contains('active')) {
Â  Â  Â  Â  Â  await listarMeusProtocolos();
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  alert("Erro ao encaminhar protocolo.");
Â  Â  Â  }
Â  Â  } catch (error) {
Â  Â  Â  console.error("Erro no encaminhamento:", error);
Â  Â  }
Â  }
}




async function abrirAtualizar(id) {
Â  const novoStatus = prompt("Digite o novo status:");
Â  if (novoStatus) {
Â  Â  try {
Â  Â  Â  const response = await fetch(`/protocolos/atualizar`, {
Â  Â  Â  Â  method: 'POST',
Â  Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  Â  protocoloId: id,
Â  Â  Â  Â  Â  novoStatus,
Â  Â  Â  Â  Â  novoResponsavel: usuarioLogado, // Garante que o responsÃ¡vel Ã© o usuÃ¡rio atual
Â  Â  Â  Â  Â  observacao: `Status atualizado por ${usuarioLogado} para ${novoStatus}`,
Â  Â  Â  Â  Â  usuarioLogado: usuarioLogado
Â  Â  Â  Â  })
Â  Â  Â  });
Â  Â  Â Â 
Â  Â  Â  Â  const data = await response.json();
Â  Â  Â Â 
Â  Â  Â  if (data.sucesso) {
Â  Â  Â  Â  alert("âœ… Status atualizado!");
Â  Â  Â  Â  // Recarrega o histÃ³rico imediatamente apÃ³s a atualizaÃ§Ã£o
Â  Â  Â  Â  await carregarHistorico(id);
Â  Â  Â  Â Â 
Â  Â  Â  Â  // Atualiza ambas as listas
Â  Â  Â  Â  if (document.getElementById('protocolos').classList.contains('active')) {
Â  Â  Â  Â  Â  await listarProtocolos();
Â  Â  Â  Â  }
Â  Â  Â  Â  if (document.getElementById('meusProtocolos').classList.contains('active')) {
Â  Â  Â  Â  Â  await listarMeusProtocolos();
Â  Â  Â  Â  }
Â  Â  Â  } else {
Â  Â  Â  Â  alert("Erro ao atualizar.");
Â  Â  Â  }
Â  Â  } catch (error) {
Â  Â  Â  console.error("Erro na atualizaÃ§Ã£o:", error);
Â  Â  Â  }
Â  }
}



async function carregarHistorico(protocoloId) {
Â  try {
Â  Â  const res = await fetch(`/protocolos/historico/${protocoloId}`);
Â  Â  const data = await res.json();

Â  Â  // Tenta encontrar o elemento em ambas as telas
Â  Â  let details = document.getElementById('hist_' + protocoloId);
Â  Â  if (!details) {
Â  Â  Â  // Se nÃ£o encontrou na tela atual, tenta na outra tabela
Â  Â  Â  const otherTable = document.getElementById('tabelaProtocolos') ||Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â document.getElementById('meusProtocolosTabela');
Â  Â  Â  if (otherTable) {
Â  Â  Â  Â  details = otherTable.querySelector('#hist_' + protocoloId);
Â  Â  Â  }
Â  Â  }

Â  Â  if (details) {
Â  Â  Â  details.innerHTML = `<summary>HistÃ³rico</summary>`;
Â  Â  Â  data.historico.forEach(h => {
Â  Â  Â  Â  const div = document.createElement('div');
Â  Â  Â  Â  div.textContent = `ğŸ“Œ ${h.status} - ğŸ‘¤ ${h.responsavel} - ğŸ•’ ${new Date(h.data_movimentacao).toLocaleString()}${h.observacao ? ` - ğŸ“ ${h.observacao}` : ''}`;
Â  Â  Â  Â  details.appendChild(div);
Â  Â  Â  });
Â  Â  }
Â  } catch (error) {
Â  Â  console.error("Erro ao carregar histÃ³rico:", error);
Â  }
}


async function gerarDocumentoPorId(id) {
Â  try {
Â  Â  const res = await fetch(`/protocolos/${id}`);
Â  Â  const { protocolo } = await res.json();
Â  Â  if (!protocolo) return alert("Protocolo nÃ£o encontrado");

Â  Â  gerarDocumentoCompleto(protocolo); // sua funÃ§Ã£o jÃ¡ existente para gerar o documento
Â  } catch (err) {
Â  Â  console.error("Erro ao gerar documento:", err);
Â  Â  alert("Erro ao gerar documento.");
Â  }
}

// VariÃ¡vel global para armazenar os dados do protocolo
let protocoloParaGerar = null;

// Nova funÃ§Ã£o para abrir o modal de prÃ©-visualizaÃ§Ã£o
async function previsualizarPDF(id) {
Â  try {
Â  Â  const res = await fetch(`/protocolos/${id}`);
Â  Â  const { protocolo } = await res.json();
Â  Â  if (!protocolo) {
Â  Â  Â  alert("Protocolo nÃ£o encontrado");
Â  Â  Â  return;
Â  Â  }
Â  Â Â 
Â  Â  // Armazena o protocolo em uma variÃ¡vel global
Â  Â  protocoloParaGerar = protocolo;

Â  Â  // Pega o modelo HTML oculto
Â  Â  const modeloOriginal = document.getElementById('modeloProtocolo');

Â  Â  // Preenche o modelo oculto com os dados
Â  Â  modeloOriginal.querySelector('#doc_numero').textContent = protocolo.numero ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_dataSolicitacao').textContent = protocolo.data_solicitacao
Â  Â  Â  ? new Date(protocolo.data_solicitacao).toLocaleDateString('pt-BR')
Â  Â  Â  : 'NÃ£o informada';
Â  Â  modeloOriginal.querySelector('#doc_nome').textContent = protocolo.nome ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_matricula').textContent = protocolo.matricula ?? 'NÃ£o informada';
Â  Â  modeloOriginal.querySelector('#doc_cpf').textContent = protocolo.cpf ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_rg').textContent = protocolo.rg ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_endereco').textContent = protocolo.endereco ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_bairro').textContent = protocolo.bairro ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_municipio').textContent = protocolo.municipio ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_cep').textContent = protocolo.cep ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_telefone').textContent = protocolo.telefone ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_cargo').textContent = protocolo.cargo ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_lotacao').textContent = protocolo.lotacao ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_unidade').textContent = protocolo.unidade_exercicio ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_tipo').textContent = protocolo.tipo_requerimento ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_requerAo').textContent = protocolo.requer_ao ?? 'NÃ£o informado';
Â  Â  modeloOriginal.querySelector('#doc_complemento').innerHTML = protocolo.observacoes
Â  Â  Â  ? protocolo.observacoes.replace(/\n/g, '<br>')
Â  Â  Â  : 'Nenhuma informaÃ§Ã£o adicional';

Â  Â  // Injeta o conteÃºdo HTML do modelo oculto na div de visualizaÃ§Ã£o
Â  Â  const pdfContentDiv = document.getElementById('pdfContent');
Â  Â  pdfContentDiv.innerHTML = modeloOriginal.innerHTML;
Â  Â Â 
Â  Â  // Exibe o modal para a visualizaÃ§Ã£o
Â  Â  document.getElementById('pdfModal').style.display = 'block';

Â  } catch (err) {
Â  Â  console.error('Erro ao preparar PDF:', err);
Â  Â  alert('Erro ao preparar a visualizaÃ§Ã£o do PDF. Verifique o console.');
Â  }
}

// FunÃ§Ã£o para fechar o modal
function fecharModal() {
Â  document.getElementById('pdfModal').style.display = 'none';
Â  document.getElementById('pdfContent').innerHTML = ''; // Limpa o conteÃºdo
Â  protocoloParaGerar = null; // Limpa o objeto global
}

// FunÃ§Ã£o que gera o PDF de fato, chamada pelo botÃ£o no modal
async function gerarPDF() {
Â  if (!protocoloParaGerar) {
Â  Â  alert("Nenhum protocolo para gerar.");
Â  Â  return;
Â  }
Â Â 
Â  const element = document.getElementById('pdfContent'); // â† Agora pega o conteÃºdo jÃ¡ visÃ­vel e renderizado

Â  const opt = {
Â  Â  margin: [0, 0, 0, 0],
Â  Â  filename: `Protocolo_${protocoloParaGerar.numero}.pdf`,
Â  Â  image: { type: 'jpeg', quality: 0.98 },
Â  Â  html2canvas: {
Â  Â  Â  scale: 2,
Â  Â  Â  scrollY: 0,
Â  Â  Â  useCORS: true
Â  Â  },
Â  Â  jsPDF: {
Â  Â  Â  unit: 'mm',
Â  Â  Â  format: 'a4',
Â  Â  Â  orientation: 'portrait',
Â  Â  }
Â  };

Â  try {
Â  Â  await html2pdf().set(opt).from(element).save();
Â  Â  fecharModal();
Â  } catch (error) {
Â  Â  console.error("Erro ao gerar PDF:", error);
Â  Â  alert("Ocorreu um erro ao gerar o PDF. Por favor, tente novamente.");
Â  }
}

// A funÃ§Ã£o gerarDocumentoPorId Ã© redundante e nÃ£o Ã© usada, pode ser removida se desejar.
async function gerarDocumentoPorId(id) {
Â  try {
Â  Â  const res = await fetch(`/protocolos/${id}`);
Â  Â  const { protocolo } = await res.json();
Â  Â  if (!protocolo) return alert("Protocolo nÃ£o encontrado");

Â  Â  previsualizarPDF(protocolo.id); // Chama a nova funÃ§Ã£o de prÃ©-visualizaÃ§Ã£o
Â  } catch (err) {
Â  Â  console.error("Erro ao gerar documento:", err);
Â  Â  alert("Erro ao gerar documento.");
Â  }
}

async function pesquisarProtocolos() {
Â  try {
Â  Â  const numero = document.getElementById('filtroNumero').value;
Â  Â  const nome = document.getElementById('filtroNome').value;
Â  Â  const status = document.getElementById('filtroStatus').value;

Â  Â  const res = await fetch(`/protocolos/pesquisa?numero=${numero}&nome=${nome}&status=${status}`);
Â  Â  const data = await res.json();

Â  Â  const tbody = document.getElementById('resultadosPesquisa');
Â  Â  tbody.innerHTML = '';

Â  Â  if (data.protocolos && data.protocolos.length > 0) {
Â  Â  Â  data.protocolos.forEach(p => {
Â  Â  Â  Â  const tr = document.createElement('tr');
Â  Â  Â  Â  tr.innerHTML = `
Â  Â  Â  Â  Â  <td>${p.numero || ''}</td>
Â  Â  Â  Â  Â  <td>${p.nome || ''}</td>
Â  Â  Â  Â  Â  <td>${p.status || ''}</td>
Â  Â  Â  Â  Â  <td>${p.data_solicitacao ? new Date(p.data_solicitacao).toLocaleDateString() : ''}</td>
Â  Â  Â  Â  Â  <td>${p.tipo || ''}</td>
Â  Â  Â  Â  Â  <td>${p.cpf || ''}</td>
Â  Â  Â  Â  `;
Â  Â  Â  Â  tbody.appendChild(tr);
Â  Â  Â  });
Â  Â  } else {
Â  Â  Â  tbody.innerHTML = '<tr><td colspan="6">Nenhum protocolo encontrado</td></tr>';
Â  Â  }
Â  } catch (error) {
Â  Â  console.error("Erro ao pesquisar protocolos:", error);
Â  }
}



// FunÃ§Ã£o para gerar relatÃ³rio em PDF
async function gerarRelatorio() {
Â  try {
Â  Â  const numero = document.getElementById('filtroNumero').value;
Â  Â  const nome = document.getElementById('filtroNome').value;
Â  Â  const status = document.getElementById('filtroStatus').value;

Â  Â  const res = await fetch(`/protocolos/pesquisa?numero=${numero}&nome=${nome}&status=${status}`);
Â  Â  const data = await res.json();

Â  Â  if (!data.protocolos || data.protocolos.length === 0) {
Â  Â  Â  alert("RelatÃ³rio nÃ£o encontrado!");
Â  Â  Â  return;
Â  Â  }

Â  Â  let html = `<h2>RelatÃ³rio de Protocolos</h2>`;
Â  Â  html += `<table border="1" cellpadding="5" cellspacing="0" style="border-collapse: collapse; width: 100%;">`;
Â  Â  html += `<thead><tr>
Â  Â  Â  <th style="width: 80px;">NÃºmero</th>
Â  Â  Â  <th>Nome</th>
Â  Â  Â  <th>Status</th>
Â  Â  Â  <th>Data SolicitaÃ§Ã£o</th>
Â  Â  Â  <th>Tipo</th>
Â  Â  Â  <th>CPF</th>
Â  Â  </tr></thead><tbody>`;

Â  Â  data.protocolos.forEach(p => {
Â  Â  Â  html += `<tr>
Â  Â  Â  Â  <td>${p.numero || ''}</td>
Â  Â  Â  Â  <td>${p.nome || ''}</td>
Â  Â  Â  Â  <td>${p.status || ''}</td>
Â  Â  Â  Â  <td>${p.data_solicitacao ? new Date(p.data_solicitacao).toLocaleDateString() : ''}</td>
Â  Â  Â  Â  <td>${p.tipo || ''}</td>
Â  Â  Â  Â  <td>${p.cpf || ''}</td>
Â  Â  Â  </tr>`;
Â  Â  });

Â  Â  html += `</tbody></table>`;

Â  Â  const tempDiv = document.createElement('div');
Â  Â  tempDiv.innerHTML = html;
Â  Â  document.body.appendChild(tempDiv);

Â  Â  const opt = {
Â  Â  Â  margin: 1,
Â  Â  Â  filename: 'relatorio_protocolos.pdf',
Â  Â  Â  image: { type: 'jpeg', quality: 0.98 },
Â  Â  Â  html2canvas: { scale: 2 },
Â  Â  Â  jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
Â  Â  };

Â  Â  await html2pdf().set(opt).from(tempDiv).save();
Â  Â  document.body.removeChild(tempDiv);

Â  } catch (err) {
Â  Â  console.error("Erro ao gerar relatÃ³rio:", err);
Â  Â  alert("Erro ao gerar o relatÃ³rio.");
Â  }
}




	async function verDetalhes(id) {
Â  try {
Â  Â  const res = await fetch(`/protocolos/${id}`);
Â  Â  const { protocolo } = await res.json();
Â  Â  if (!protocolo) return alert("Protocolo nÃ£o encontrado");

Â  Â  let detalhes = "Detalhes do Protocolo:\n\n";
Â  Â  const campos = [
Â  Â  Â  ['NÃºmero', protocolo.numero],
Â  Â  Â  ['MatrÃ­cula', protocolo.matricula],
Â  Â  Â  ['Nome Completo', protocolo.nome],
Â  Â  Â  ['EndereÃ§o', protocolo.endereco],
Â  Â  Â  ['MunicÃ­pio', protocolo.municipio],
Â  Â  Â  ['Bairro', protocolo.bairro],
Â  Â  Â  ['CEP', protocolo.cep],
Â  Â  Â  ['Telefone', protocolo.telefone],
Â  Â  Â  ['CPF', protocolo.cpf],
Â  Â  Â  ['RG', protocolo.rg],
Â  Â  Â  ['Data de ExpediÃ§Ã£o', protocolo.dataExpedicao],
Â  Â  Â  ['Cargo/FunÃ§Ã£o', protocolo.cargo],
Â  Â  Â  ['LotaÃ§Ã£o', protocolo.lotacao],
Â  Â  Â  ['Unidade de ExercÃ­cio', protocolo.unidade],
Â  Â  Â  ['Tipo de Requerimento', protocolo.tipo],
Â  Â  Â  ['Requer ao', protocolo.requerAo],
Â  Â  Â  ['Data SolicitaÃ§Ã£o', protocolo.dataSolicitacao],
Â  Â  Â  ['InformaÃ§Ãµes Complementares', protocolo.complemento]
Â  Â  ];
Â  Â  campos.forEach(c => detalhes += `${c[0]}: ${c[1] || ''}\n`);
Â  Â  alert(detalhes);

Â  } catch (err) {
Â  Â  alert("Erro ao buscar detalhes.");
Â  Â  console.error(err);
Â  }
}



Â  Â Â 
Â  Â  function salvarEmailSistema() {
Â  Â  Â  emailSistema = document.getElementById('emailSistemaConfig').value;
Â  Â  Â  localStorage.setItem('emailSistema', emailSistema);
Â  Â  Â  alert("Email salvo com sucesso!");
Â  Â  }

async function cadastrarUsuario() {
Â  const nomeCompleto = document.getElementById('nomeCompleto').value.trim();
Â  const login = document.getElementById('novoUsuario').value.trim();
Â  const cpf = document.getElementById('cpfUsuario').value.trim();
Â  const senha = document.getElementById('novaSenha').value.trim();
Â  const email = document.getElementById('novoEmail').value.trim();
Â  const tipo = document.getElementById('nivelUsuario').value;

Â  if (!nomeCompleto || !login || !cpf || !senha || !email || !tipo) {
Â  Â  alert('Por favor, preencha todos os campos.');
Â  Â  return;
Â  }

Â  try {
Â  Â  const res = await fetch('/usuarios', {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  nome: nomeCompleto,
Â  Â  Â  Â  login,
Â  Â  Â  Â  cpf,
Â  Â  Â  Â  senha,
Â  Â  Â  Â  email,
Â  Â  Â  Â  tipo
Â  Â  Â  })
Â  Â  });

Â  Â  const data = await res.json();
Â  Â  alert(data.mensagem || 'UsuÃ¡rio cadastrado!');
Â  Â  if (data.sucesso) carregarUsuarios(); // Atualiza a tabela
Â  } catch (error) {
Â  Â  console.error('Erro ao cadastrar usuÃ¡rio:', error);
Â  Â  alert('Erro ao cadastrar usuÃ¡rio.');
Â  }
}




async function atualizarListaUsuarios() {
Â  try {
Â  Â  const response = await fetch('/usuarios');
Â  Â  if (!response.ok) throw new Error('Erro ao buscar usuÃ¡rios');
Â  Â  const data = await response.json();

Â  Â  const ul = document.getElementById('listaUsuarios');
Â  Â  ul.innerHTML = "";

Â  Â  data.usuarios.forEach(u => {
Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  li.textContent = `${u.nome} (${u.tipo}) - ${u.email}`;
Â  Â  Â  ul.appendChild(li);
Â  Â  });
Â  } catch (error) {
Â  Â  alert('Erro ao carregar usuÃ¡rios: ' + error.message);
Â  }
}

function voltarDeRelatorios() {
Â  mostrarTela('menu'); // ou outra tela que desejar
}

async function gerarBackup() {
Â  const dataInicio = document.getElementById('backupDataInicio').value;
Â  const dataFim = document.getElementById('backupDataFim').value;

Â  if (!dataInicio || !dataFim) {
Â  Â  alert("Por favor, selecione o perÃ­odo completo (data inÃ­cio e fim).");
Â  Â  return;
Â  }

Â  try {
Â  Â  const url = `/protocolos/backup?dataInicio=${dataInicio}&dataFim=${dataFim}`;
Â  Â  const response = await fetch(url);

Â  Â  if (!response.ok) {
Â  Â  Â  const textoErro = await response.text();
Â  Â  Â  alert(`Erro ao gerar backup: ${textoErro || response.statusText}`);
Â  Â  Â  return;
Â  Â  }

Â  Â  const blob = await response.blob();
Â  Â  const urlBlob = window.URL.createObjectURL(blob);

Â  Â  const a = document.createElement('a');
Â  Â  a.href = urlBlob;
Â  Â  a.download = `backup_protocolos_${dataInicio}_a_${dataFim}.xlsx`;
Â  Â  document.body.appendChild(a);
Â  Â  a.click();
Â  Â  a.remove();

Â  Â  window.URL.revokeObjectURL(urlBlob);

Â  } catch (error) {
Â  Â  console.error("Erro ao gerar backup:", error);
Â  Â  alert("Erro ao gerar backup. Veja console.");
Â  }
}

async function abrirModalEncaminhar(idProtocolo, event) {
Â  try {
Â  Â  const res = await fetch('/usuarios');
Â  Â  const data = await res.json();

Â  Â  const select = document.getElementById('selectUsuarioEncaminhar');
Â  Â  select.innerHTML = ''; // limpa opÃ§Ãµes

Â  Â  data.usuarios.forEach(usuario => {
Â  Â  Â  const option = document.createElement('option');
Â  Â  Â  option.value = usuario.login;
Â  Â  Â  option.textContent = `${usuario.nome_completo || usuario.login} (${usuario.tipo})`;
Â  Â  Â  select.appendChild(option);
Â  Â  });

Â  Â  // Armazena o protocolo atual para uso no confirmar
Â  Â  select.dataset.idProtocolo = idProtocolo;

Â  Â  // Posiciona o modal fixo e centralizado (pelo CSS)
Â  Â  const modal = document.getElementById('modalEncaminhar');
Â  Â  modal.style.position = 'fixed';
Â  Â  modal.style.top = '50%';
Â  Â  modal.style.left = '50%';
Â  Â  modal.style.transform = 'translate(-50%, -50%)';

Â  Â  modal.style.display = 'flex';Â  // mostra o modal

Â  } catch (error) {
Â  Â  alert('Erro ao carregar usuÃ¡rios');
Â  Â  console.error(error);
Â  }
}


async function confirmarEncaminhamento() {
Â  const select = document.getElementById('selectUsuarioEncaminhar');
Â  const idProtocolo = select.dataset.idProtocolo;
Â  const destino = select.value;

Â  try {
Â  Â  const response = await fetch('/protocolos/atualizar', {
Â  Â  Â  method: 'POST',
Â  Â  Â  headers: { 'Content-Type': 'application/json' },
Â  Â  Â  body: JSON.stringify({
Â  Â  Â  Â  protocoloId: idProtocolo,
Â  Â  Â  Â  novoStatus: 'Encaminhado',
Â  Â  Â  Â  novoResponsavel: destino,
Â  Â  Â  Â  observacao: `Encaminhado por ${usuarioLogado} para ${destino}`,
Â  Â  Â  Â  usuarioLogado: usuarioLogado
Â  Â  Â  })
Â  Â  });

Â  Â  const data = await response.json();

Â  Â  if (data.sucesso) {
Â  Â  Â  alert('âœ… Protocolo encaminhado com sucesso!');
Â  Â  Â  fecharModalEncaminhar();
Â  Â  Â  await listarProtocolos();
Â  Â  Â  await listarMeusProtocolos();
Â  Â  } else {
Â  Â  Â  alert('âŒ Erro ao encaminhar protocolo: ' + (data.mensagem || ''));
Â  Â  }
Â  } catch (err) {
Â  Â  console.error(err);
Â  Â  alert('âŒ Erro ao encaminhar protocolo');
Â  }
}

function fecharModalEncaminhar() {
Â  const modal = document.getElementById('modalEncaminhar');
Â  modal.style.display = 'none';
}

function renderizarPaginacao(totalItens, paginaAtual, idContainer, callback) {
Â  const container = document.getElementById(idContainer);
Â  container.innerHTML = '';

Â  const totalPaginas = Math.ceil(totalItens / itensPorPagina);

Â  if (totalPaginas <= 1) return; // sem paginaÃ§Ã£o se tiver 1 pÃ¡gina

Â  for (let i = 1; i <= totalPaginas; i++) {
Â  Â  const btn = document.createElement('button');
Â  Â  btn.textContent = i;
Â  Â  btn.style.margin = '0 2px';
Â  Â  if (i === paginaAtual) {
Â  Â  Â  btn.disabled = true;
Â  Â  }
Â  Â  btn.onclick = () => callback(i);
Â  Â  container.appendChild(btn);
Â  }
}

	Â 
Â  Â  function voltarDeMeusProtocolos() {
Â  Â  Â  if (nivelUsuario === 'comum') {
Â  Â  Â  Â  sair();
Â  Â  Â  } else {
Â  Â  Â  Â  mostrarTela('menu');
Â  Â  Â  }
Â  Â  }

function preencherCamposServidor(servidor) {
Â  Â  if (!servidor) {
Â  Â  Â  // Limpa os campos apenas se matricula estiver vazia (campo apagado)
Â  Â  Â  document.getElementById('nome').value = '';
Â  Â  Â  document.getElementById('lotacao').value = '';
Â  Â  Â  document.getElementById('cargo').value = '';
Â  Â  Â  document.getElementById('unidade').value = '';
Â  Â  } else {
Â  Â  Â  document.getElementById('nome').value = servidor.nome || '';
Â  Â  Â  document.getElementById('lotacao').value = servidor.lotacao || '';
Â  Â  Â  document.getElementById('cargo').value = servidor.cargo || '';
Â  Â  Â  document.getElementById('unidade').value = servidor.unidade_de_exercicio || '';
Â  Â  }
Â  }

Â  // Evento blur para disparar busca ao sair do campo matrÃ­cula
Â  document.getElementById('matricula').addEventListener('blur', async function() {
Â  Â  const matricula = this.value.trim();
Â  Â  if (!matricula) {
Â  Â  Â  preencherCamposServidor(null);
Â  Â  Â  return;
Â  Â  }

Â  Â  try {
Â  Â  Â  const response = await fetch(`/protocolos/servidor/${encodeURIComponent(matricula)}`);

Â  Â  Â  if (!response.ok) {
Â  Â  Â  Â  // Se nÃ£o encontrado, NÃƒO limpa os campos, deixa para digitaÃ§Ã£o manual
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const servidor = await response.json();
Â  Â  Â  preencherCamposServidor(servidor);
Â  Â  } catch (error) {
Â  Â  Â  console.error('Erro ao buscar servidor:', error);
Â  Â  Â  // Em caso de erro, mantÃ©m campos como estÃ£o
Â  Â  }
Â  });

Â  </script>

<script>
Â  document.getElementById('cep').addEventListener('blur', async function () {
Â  Â  const cep = this.value.replace(/\D/g, '');

Â  Â  if (cep.length !== 8) {
Â  Â  Â  alert('CEP invÃ¡lido. Digite os 8 dÃ­gitos.');
Â  Â  Â  return;
Â  Â  }

Â  Â  try {
Â  Â  Â  const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
Â  Â  Â  const data = await response.json();

Â  Â  Â  if (data.erro) {
Â  Â  Â  Â  alert('CEP nÃ£o encontrado!');
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  document.getElementById('endereco').value = data.logradouro || '';
Â  Â  Â  document.getElementById('bairro').value = data.bairro || '';
Â  Â  Â  document.getElementById('municipio').value = data.localidade || '';
Â  Â  } catch (error) {
Â  Â  Â  console.error('Erro ao buscar CEP:', error);
Â  Â  Â  alert('Erro ao buscar o CEP. Verifique sua conexÃ£o.');
Â  Â  }
Â  });
</script>

</body>
</html>

