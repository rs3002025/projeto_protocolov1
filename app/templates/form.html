{% extends "base.html" %}

{% block title %}Novo Protocolo - Sistema de Protocolo{% endblock %}

{% block content %}
<div class="form-screen content active">
    <h3 style="margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--border-color);">Novo Protocolo</h3>
    <form class="formulario" onsubmit="enviarRequerimento(); return false;">
      <div class="form-group span-3"><label for="numeroProtocolo">Número do Protocolo</label><input type="text" id="numeroProtocolo" readonly></div>
      <div class="form-group span-3"><label for="dataSolicitacao">Data Solicitação</label><input type="date" id="dataSolicitacao"></div>

      <div class="form-group span-2"><label for="matricula">Matrícula</label><input type="text" id="matricula"></div>
      <div class="form-group span-3"><label for="nome">Nome Completo</label><input type="text" id="nome"></div>
      <div class="form-group span-1" style="justify-content: flex-end;"><button id="btnBuscarNome" type="button" onclick="abrirModalBuscaServidor()">Buscar</button></div>

      <div class="form-group span-3"><label for="cpf">CPF</label><input type="text" id="cpf"></div>
      <div class="form-group span-3"><label for="rg">RG</label><input type="text" id="rg"></div>

      <div class="form-group span-3"><label for="cargo">Cargo/Função</label><input type="text" id="cargo"></div>
      <div class="form-group span-3"><label for="lotacao">Lotação</label><select id="lotacao"><option value="">Selecione...</option></select></div>
      <div class="form-group span-6"><label for="unidade">Unidade de Exercício</label><input type="text" id="unidade"></div>

      <div class="form-group span-4"><label for="endereco">Endereço</label><input type="text" id="endereco"></div>
      <div class="form-group span-2"><label for="bairro">Bairro</label><select id="bairro" name="bairro"><option value="">Selecione um bairro</option></select></div>

      <div class="form-group span-2"><label for="municipio">Município</label><input type="text" id="municipio" value="Morada Nova"></div>
      <div class="form-group span-2"><label for="cep">CEP</label><input type="text" id="cep"></div>
      <div class="form-group span-2"><label for="telefone">Telefone</label><input type="text" id="telefone"></div>

      <div class="form-group span-3"><label for="tipo">Tipo de Requerimento</label><select id="tipo"><option value="">Selecione...</option></select></div>
      <div class="form-group span-3"><label for="requerAo">Requer ao</label><select id="requerAo"><option value="">Selecione...</option><option value="SECRETÁRIO">SECRETÁRIO</option><option value="COORDENADOR DE RH">COORDENADOR DE RH</option><option value="PREFEITA">PREFEITA</option></select></div>

      <div class="form-group full-row"><label for="complemento">Informações Complementares</label><textarea id="complemento" rows="6"></textarea></div>

      <div class="form-group full-row">
          <label for="anexos">Anexar Documentos</label>
          <input type="file" id="anexos" multiple onchange="previewFiles(this)">
          <div id="filePreviewContainer" class="file-preview"></div>
      </div>

      <div class="form-group full-row" style="flex-direction: row; justify-content: flex-end; gap: 15px; margin-top: 20px;">
        <a href="{{ url_for('main.menu') }}" class="button-link" style="background-color: #6c757d;">Voltar</a>
        <button type="button" onclick="previsualizarPDF(null, true)" style="background-color: #17a2b8;">Imprimir</button>
        <button type="submit">Enviar Requerimento</button>
      </div>
    </form>
</div>

<script>
    // Inicialização específica para a página de formulário
    document.addEventListener('DOMContentLoaded', () => {
        popularDropdownsFormulario();
        gerarNumeroProtocolo();
        // Define a data de solicitação padrão como hoje
        const dataSolicitacaoInput = document.getElementById('dataSolicitacao');
        if (!dataSolicitacaoInput.value) {
            dataSolicitacaoInput.value = new Date().toISOString().split('T')[0];
        }
    });
</script>
{% endblock %}
