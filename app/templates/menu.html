{% extends "base.html" %}

{% block title %}Menu Principal - Sistema de Protocolo{% endblock %}

{% block content %}
<div class="menu-screen content active">
    <a href="{{ url_for('main.dashboard') }}" class="menu-button" id="btnDashboard"><span class="icon">üìà</span>Dashboard</a>
    <a href="{{ url_for('main.form') }}" class="menu-button" id="btnNovo"><span class="icon">üìÑ</span>Novo Protocolo</a>
    <a href="{{ url_for('main.protocolos') }}" class="menu-button" id="btnTodosProtocolos"><span class="icon">üóÇÔ∏è</span>Todos os Protocolos</a>
    <a href="{{ url_for('main.relatorios') }}" class="menu-button" id="btnRelatorios"><span class="icon">üìä</span>Relat√≥rios</a>
    <a href="{{ url_for('main.meus_protocolos') }}" class="menu-button" id="btnMeusProtocolos"><span class="icon">üìÇ</span>Meus Protocolos</a>
    <a href="{{ url_for('main.config') }}" class="menu-button" id="btnConfig"><span class="icon">‚öôÔ∏è</span>Configura√ß√µes</a>
    <a href="#" onclick="abrirModalAlterarSenha(); return false;" class="menu-button"><span class="icon">üîë</span>Alterar Senha</a>
    <a href="#" onclick="sair(); return false;" class="menu-button"><span class="icon">üö™</span>Sair</a>
</div>

<script>
    // L√≥gica de visibilidade dos bot√µes, adaptada para o MPA
    document.addEventListener('DOMContentLoaded', () => {
        const nivelUsuario = localStorage.getItem('nivelUsuario') || "";
        const isAdmin = nivelUsuario === 'admin';
        const isSuperAdmin = nivelUsuario === 'super_admin';
        const isPadrao = nivelUsuario === 'padrao';
        const isUsuario = nivelUsuario === 'usuario';

        const btnDashboard = document.getElementById('btnDashboard');
        const btnConfig = document.getElementById('btnConfig');
        const btnNovo = document.getElementById('btnNovo');
        const btnRelatorios = document.getElementById('btnRelatorios');
        const btnTodosProtocolos = document.getElementById('btnTodosProtocolos');
        const btnMeusProtocolos = document.getElementById('btnMeusProtocolos');

        // Oculta todos os bot√µes que dependem de permiss√£o
        if (btnDashboard) btnDashboard.style.display = 'none';
        if (btnConfig) btnConfig.style.display = 'none';
        if (btnNovo) btnNovo.style.display = 'none';
        if (btnRelatorios) btnRelatorios.style.display = 'none';
        if (btnTodosProtocolos) btnTodosProtocolos.style.display = 'none';
        if (btnMeusProtocolos) btnMeusProtocolos.style.display = 'none';

        // L√≥gica de exibi√ß√£o baseada na role
        if (isSuperAdmin) {
            if (btnConfig) btnConfig.style.display = 'flex';
        } else {
            // Permiss√µes para usu√°rios de tenant
            if (btnMeusProtocolos) btnMeusProtocolos.style.display = 'flex';

            if (isUsuario || isPadrao || isAdmin) {
                if (btnNovo) btnNovo.style.display = 'flex';
            }
            if (isPadrao || isAdmin) {
                if (btnDashboard) btnDashboard.style.display = 'flex';
                if (btnRelatorios) btnRelatorios.style.display = 'flex';
                if (btnTodosProtocolos) btnTodosProtocolos.style.display = 'flex';
            }
            if (isAdmin) {
                if (btnConfig) btnConfig.style.display = 'flex';
            }
        }
    });
</script>
{% endblock %}
