{% extends "layout.html" %}
{% block content %}
<div class="container-fluid">
    <h1>Configurações do Sistema</h1>
    <p class="text-muted">Página de administração para gerenciar usuários e listas do sistema.</p>

    <!-- User Management Section -->
    <div class="card mt-4">
        <div class="card-header">
            <h4>Gerenciamento de Usuários</h4>
        </div>
        <div class="card-body">
            <h5>Criar Novo Usuário</h5>
            <form method="POST" action="{{ url_for('admin_create_user') }}">
                {{ user_form.hidden_tag() }}
                <div class="row">
                    <div class="col-md-6 mb-3">{{ user_form.nome_completo.label }} {{ user_form.nome_completo(class="form-control") }}</div>
                    <div class="col-md-6 mb-3">{{ user_form.login.label }} {{ user_form.login(class="form-control") }}</div>
                    <div class="col-md-6 mb-3">{{ user_form.email.label }} {{ user_form.email(class="form-control") }}</div>
                    <div class="col-md-6 mb-3">{{ user_form.senha.label }} {{ user_form.senha(class="form-control") }}</div>
                    <div class="col-md-6 mb-3">{{ user_form.tipo.label }} {{ user_form.tipo(class="form-select") }}</div>
                    <div class="col-md-6 align-self-end mb-3">{{ user_form.submit(class="btn btn-primary") }}</div>
                </div>
            </form>
            <hr>
            <h5>Usuários Existentes</h5>
            <table class="table table-striped">
                <thead>
                    <tr><th>Nome Completo</th><th>Login</th><th>Email</th><th>Tipo</th><th>Status</th><th>Ações</th></tr>
                </thead>
                <tbody>
                    {% for user in users %}
                    <tr>
                        <td>{{ user.nome_completo }}</td>
                        <td>{{ user.login }}</td>
                        <td>{{ user.email }}</td>
                        <td>{{ user.tipo }}</td>
                        <td><span class="badge {{ 'bg-success' if user.status == 'ativo' else 'bg-danger' }}">{{ user.status }}</span></td>
                        <td>
                            <button class="btn btn-sm btn-secondary" onclick='openEditUserModal({{ user | tojson }})'>Editar</button>
                            <button class="btn btn-sm btn-warning" onclick='openResetPasswordModal({{ user.id }})'>Resetar Senha</button>
                            <form method="POST" action="{{ url_for('admin_toggle_user_status', user_id=user.id) }}" class="d-inline">
                                <button type="submit" class="btn btn-sm {{ 'btn-danger' if user.status == 'ativo' else 'btn-success' }}">
                                    {{ 'Desativar' if user.status == 'ativo' else 'Reativar' }}
                                </button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- List Management Section -->
    <div class="row mt-4">
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header"><h4>Gerenciar Tipos de Requerimento</h4></div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('admin_create_list_item', item_type='tipo') }}">
                        {{ tipo_form.hidden_tag() }}
                        <div class="input-group">
                            {{ tipo_form.nome(class="form-control", placeholder="Novo tipo") }}
                            {{ tipo_form.submit(class="btn btn-primary") }}
                        </div>
                    </form>
                    <hr>
                    <ul class="list-group">
                        {% for tipo in tipos %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ tipo.nome }}
                            <form method="POST" action="{{ url_for('admin_toggle_item_status', item_type='tipo', item_id=tipo.id) }}" class="d-inline">
                                <button type="submit" class="btn btn-sm {{ 'btn-warning' if tipo.ativo else 'btn-success' }}">
                                    {{ 'Desativar' if tipo.ativo else 'Reativar' }}
                                </button>
                            </form>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="card">
                <div class="card-header"><h4>Gerenciar Lotações</h4></div>
                <div class="card-body">
                     <form method="POST" action="{{ url_for('admin_create_list_item', item_type='lotacao') }}">
                        {{ lotacao_form.hidden_tag() }}
                        <div class="input-group">
                            {{ lotacao_form.nome(class="form-control", placeholder="Nova lotação") }}
                            {{ lotacao_form.submit(class="btn btn-primary") }}
                        </div>
                    </form>
                    <hr>
                    <ul class="list-group">
                        {% for lotacao in lotacoes %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ lotacao.nome }}
                             <form method="POST" action="{{ url_for('admin_toggle_item_status', item_type='lotacao', item_id=lotacao.id) }}" class="d-inline">
                                <button type="submit" class="btn btn-sm {{ 'btn-warning' if lotacao.ativo else 'btn-success' }}">
                                    {{ 'Desativar' if lotacao.ativo else 'Reativar' }}
                                </button>
                            </form>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}
